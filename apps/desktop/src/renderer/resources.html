<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PromptX Resources</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
      background: #ffffff;
      color: #24292f;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      background: #f6f8fa;
      border-bottom: 1px solid #d0d7de;
      padding: 16px;
    }
    
    .header-content {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo {
      font-size: 20px;
      font-weight: 600;
      color: #24292f;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo-icon {
      font-size: 24px;
    }
    
    /* Stats Bar */
    .stats-bar {
      background: #ffffff;
      border-bottom: 1px solid #d0d7de;
      padding: 12px 16px;
    }
    
    .stats-content {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      gap: 24px;
      align-items: center;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .stat-label {
      color: #57606a;
    }
    
    .stat-value {
      color: #24292f;
      font-weight: 600;
    }
    
    .stat-badge {
      background: #f6f8fa;
      color: #0969da;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    /* Main Container */
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    
    /* Search and Filter Bar */
    .toolbar {
      margin-bottom: 20px;
    }
    
    .search-bar {
      margin-bottom: 12px;
    }
    
    .search-input {
      width: 100%;
      padding: 8px 12px;
      background: #ffffff;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      color: #24292f;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #0969da;
      box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
    }
    
    .search-input::placeholder {
      color: #6e7681;
    }
    
    /* Filter Controls */
    .filter-controls {
      display: flex;
      gap: 16px;
      align-items: center;
      padding: 12px;
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
    }
    
    .filter-group {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .filter-label {
      font-size: 13px;
      color: #57606a;
      font-weight: 500;
      margin-right: 8px;
    }
    
    .filter-tabs {
      display: flex;
      gap: 0;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #d0d7de;
    }
    
    .filter-tab, .source-tab {
      padding: 4px 12px;
      background: #ffffff;
      border: none;
      color: #57606a;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      border-right: 1px solid #d0d7de;
    }
    
    .filter-tab:last-child, .source-tab:last-child {
      border-right: none;
    }
    
    .filter-tab:hover, .source-tab:hover {
      background: #f6f8fa;
      color: #24292f;
    }
    
    .filter-tab.active, .source-tab.active {
      background: #0969da;
      color: white;
    }
    
    .divider {
      width: 1px;
      height: 24px;
      background: #d0d7de;
    }
    
    /* Resource List */
    .resource-list {
      border: 1px solid #d0d7de;
      border-radius: 6px;
      overflow: hidden;
      background: #ffffff;
    }
    
    .list-header {
      background: #f6f8fa;
      padding: 16px;
      border-bottom: 1px solid #d0d7de;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .list-title {
      font-size: 14px;
      color: #57606a;
    }
    
    .list-count {
      background: #ffffff;
      color: #0969da;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      border: 1px solid #d0d7de;
    }
    
    /* Resource Items */
    .resource-item {
      padding: 16px;
      border-bottom: 1px solid #d0d7de;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.2s;
      background: #ffffff;
    }
    
    .resource-item:hover {
      background: #f6f8fa;
    }
    
    .resource-item:last-child {
      border-bottom: none;
    }
    
    .resource-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .resource-name {
      font-size: 16px;
      font-weight: 600;
      color: #0969da;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .resource-name:hover {
      text-decoration: underline;
    }
    
    .resource-description {
      font-size: 14px;
      color: #57606a;
    }
    
    .resource-meta {
      display: flex;
      gap: 16px;
      align-items: center;
      font-size: 12px;
      color: #6e7681;
      margin-top: 4px;
    }
    
    .resource-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Badges */
    .badge {
      padding: 2px 7px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .badge-role {
      background: #ddf4ff;
      color: #0969da;
      border: 1px solid #54aeff;
    }
    
    .badge-tool {
      background: #fbefff;
      color: #8250df;
      border: 1px solid #d2a8ff;
    }
    
    .badge-system {
      background: #ddf4ff;
      color: #0969da;
    }
    
    .badge-user {
      background: #dafbe1;
      color: #1a7f37;
    }
    
    .badge-project {
      background: #fff8c5;
      color: #9a6700;
    }
    
    /* Empty State */
    .empty-state {
      padding: 48px;
      text-align: center;
      color: #57606a;
    }
    
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
    
    .empty-title {
      font-size: 18px;
      margin-bottom: 8px;
      color: #24292f;
    }
    
    .empty-description {
      font-size: 14px;
      color: #57606a;
    }
    
    /* Loading State */
    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #d0d7de;
      border-top-color: #0969da;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Section Headers */
    .section-header {
      background: #f6f8fa;
      padding: 8px 16px;
      border-bottom: 1px solid #d0d7de;
      font-size: 12px;
      font-weight: 600;
      color: #57606a;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-icon {
      opacity: 0.7;
    }
    
    /* Action Button */
    .action-button {
      padding: 5px 12px;
      background: #2da44e;
      color: white;
      border: 1px solid #2da44e;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .action-button:hover {
      background: #2c974b;
      border-color: #2c974b;
    }
    
    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <span class="logo-icon">üöÄ</span>
        <span>PromptX Resources</span>
      </div>
    </div>
  </header>
  
  <!-- Stats Bar -->
  <div class="stats-bar">
    <div class="stats-content" id="statsBar">
      <div class="stat-item">
        <span class="stat-label">Total:</span>
        <span class="stat-value" id="statTotal">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Roles:</span>
        <span class="stat-badge" id="statRoles">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Tools:</span>
        <span class="stat-badge" id="statTools">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">System:</span>
        <span class="stat-value" id="statSystem">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">User:</span>
        <span class="stat-value" id="statUser">0</span>
      </div>
    </div>
  </div>
  
  <!-- Main Container -->
  <div class="container">
    <!-- Search and Filter -->
    <div class="toolbar">
      <!-- Search Bar -->
      <div class="search-bar">
        <input 
          type="text" 
          class="search-input" 
          id="searchInput"
          placeholder="Search resources..."
        />
      </div>
      
      <!-- Filter Controls -->
      <div class="filter-controls">
        <!-- Type Filter -->
        <div class="filter-group">
          <span class="filter-label">Type:</span>
          <div class="filter-tabs">
            <button class="filter-tab active" data-filter="all">All</button>
            <button class="filter-tab" data-filter="roles">Roles</button>
            <button class="filter-tab" data-filter="tools">Tools</button>
          </div>
        </div>
        
        <div class="divider"></div>
        
        <!-- Source Filter -->
        <div class="filter-group">
          <span class="filter-label">Source:</span>
          <div class="filter-tabs">
            <button class="source-tab active" data-source="all">All</button>
            <button class="source-tab" data-source="system">System</button>
            <button class="source-tab" data-source="user">User</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Resource List -->
    <div class="resource-list" id="resourceList">
      <div class="list-header">
        <span class="list-title">Loading resources...</span>
        <div class="loading-spinner"></div>
      </div>
      <div class="empty-state">
        <div class="empty-icon">‚è≥</div>
        <div class="empty-title">Loading resources</div>
        <div class="empty-description">Please wait...</div>
      </div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script>
    // Simple resource manager for GitHub style UI
    class GitHubResourceManager {
      constructor() {
        this.resources = []
        this.filteredResources = []
        this.currentFilter = 'all'
        this.currentSource = 'all'
        this.searchQuery = ''
        this.init()
      }
      
      async init() {
        this.setupEventListeners()
        await this.loadResources()
      }
      
      setupEventListeners() {
        // Search
        const searchInput = document.getElementById('searchInput')
        searchInput.addEventListener('input', (e) => {
          this.searchQuery = e.target.value.toLowerCase()
          this.applyFilters()
        })
        
        // Type filter tabs
        const filterTabs = document.querySelectorAll('.filter-tab')
        filterTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            filterTabs.forEach(t => t.classList.remove('active'))
            tab.classList.add('active')
            this.currentFilter = tab.dataset.filter
            this.applyFilters()
          })
        })
        
        // Source filter tabs
        const sourceTabs = document.querySelectorAll('.source-tab')
        sourceTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            sourceTabs.forEach(t => t.classList.remove('active'))
            tab.classList.add('active')
            this.currentSource = tab.dataset.source
            this.applyFilters()
          })
        })
      }
      
      async loadResources() {
        try {
          // Direct check for electronAPI
          if (!window.electronAPI) {
            console.error('electronAPI not available!')
            this.showError('IPC not initialized')
            return
          }
          
          const result = await window.electronAPI.getGroupedResources()
          
          if (result.success) {
            const { grouped, statistics } = result.data
            
            // Convert grouped to flat list
            this.resources = []
            Object.keys(grouped).forEach(source => {
              const group = grouped[source]
              if (group.roles) {
                group.roles.forEach(role => {
                  this.resources.push({ ...role, type: 'role', source })
                })
              }
              if (group.tools) {
                group.tools.forEach(tool => {
                  this.resources.push({ ...tool, type: 'tool', source })
                })
              }
            })
            
            // Update stats
            this.updateStats(statistics)
            
            // Show resources
            this.filteredResources = [...this.resources]
            this.renderResources()
          } else {
            this.showError('Failed to load resources')
          }
        } catch (error) {
          console.error('Error loading resources:', error)
          this.showError(error.message)
        }
      }
      
      updateStats(stats) {
        document.getElementById('statTotal').textContent = stats.totalRoles + stats.totalTools
        document.getElementById('statRoles').textContent = stats.totalRoles
        document.getElementById('statTools').textContent = stats.totalTools
        document.getElementById('statSystem').textContent = stats.systemRoles + stats.systemTools
        document.getElementById('statUser').textContent = stats.userRoles + stats.userTools
      }
      
      applyFilters() {
        this.filteredResources = this.resources.filter(resource => {
          // Type filter
          if (this.currentFilter !== 'all' && resource.type !== this.currentFilter.slice(0, -1)) {
            return false
          }
          
          // Source filter
          if (this.currentSource !== 'all' && resource.source !== this.currentSource) {
            return false
          }
          
          // Search filter
          if (this.searchQuery) {
            const searchText = [
              resource.id,
              resource.name,
              resource.description
            ].join(' ').toLowerCase()
            
            if (!searchText.includes(this.searchQuery)) {
              return false
            }
          }
          
          return true
        })
        
        this.renderResources()
      }
      
      renderResources() {
        const container = document.getElementById('resourceList')
        
        if (this.filteredResources.length === 0) {
          container.innerHTML = `
            <div class="list-header">
              <span class="list-title">No resources found</span>
            </div>
            <div class="empty-state">
              <div class="empty-icon">üì≠</div>
              <div class="empty-title">No resources match your filter</div>
              <div class="empty-description">Try adjusting your search or filters</div>
            </div>
          `
          return
        }
        
        // Group by source
        const bySource = {
          system: [],
          project: [],
          user: []
        }
        
        this.filteredResources.forEach(resource => {
          if (bySource[resource.source]) {
            bySource[resource.source].push(resource)
          }
        })
        
        let html = `
          <div class="list-header">
            <span class="list-title">Resources</span>
            <span class="list-count">${this.filteredResources.length}</span>
          </div>
        `
        
        // Render each source group
        Object.keys(bySource).forEach(source => {
          const resources = bySource[source]
          if (resources.length > 0) {
            html += `
              <div class="section-header">
                <span class="section-icon">${this.getSourceIcon(source)}</span>
                <span>${source}</span>
              </div>
            `
            
            resources.forEach(resource => {
              html += this.renderResource(resource)
            })
          }
        })
        
        container.innerHTML = html
      }
      
      renderResource(resource) {
        const icon = resource.type === 'role' ? 'üë§' : 'üîß'
        const typeClass = resource.type === 'role' ? 'badge-role' : 'badge-tool'
        const sourceClass = `badge-${resource.source}`
        
        return `
          <div class="resource-item" data-id="${resource.id}" data-type="${resource.type}">
            <div class="resource-info">
              <div class="resource-name">
                ${icon} ${resource.name || resource.id}
              </div>
              <div class="resource-description">
                ${resource.description || 'No description available'}
              </div>
              <div class="resource-meta">
                <span class="badge ${typeClass}">${resource.type}</span>
                <span class="badge ${sourceClass}">${resource.source}</span>
                <span class="resource-meta-item">ID: ${resource.id}</span>
              </div>
            </div>
          </div>
        `
      }
      
      getSourceIcon(source) {
        const icons = {
          system: 'üì¶',
          project: 'üìÅ',
          user: 'üë§'
        }
        return icons[source] || 'üìÑ'
      }
      
      showError(message) {
        const container = document.getElementById('resourceList')
        container.innerHTML = `
          <div class="list-header">
            <span class="list-title">Error</span>
          </div>
          <div class="empty-state">
            <div class="empty-icon">‚ùå</div>
            <div class="empty-title">Failed to load resources</div>
            <div class="empty-description">${message}</div>
          </div>
        `
      }
      
      showNotification(message) {
        // Simple notification
        const notification = document.createElement('div')
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #238636;
          color: white;
          padding: 12px 16px;
          border-radius: 6px;
          font-size: 14px;
          z-index: 1000;
          animation: slideIn 0.3s ease;
        `
        notification.textContent = message
        document.body.appendChild(notification)
        
        setTimeout(() => {
          document.body.removeChild(notification)
        }, 3000)
      }
    }
    
    // Initialize when DOM is ready
    window.addEventListener('DOMContentLoaded', () => {
      new GitHubResourceManager()
    })
  </script>
</body>
</html>