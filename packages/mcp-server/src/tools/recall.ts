import type { ToolWithHandler } from '~/interfaces/MCPServer.js';
import { MCPOutputAdapter } from '~/utils/MCPOutputAdapter.js';

const outputAdapter = new MCPOutputAdapter();

export const recallTool: ToolWithHandler = {
  name: 'recall',
  description: `ã€è®¤çŸ¥ä¹ æƒ¯ã€‘åŸºäºŽè®°å¿†ç½‘ç»œçš„è¯­ä¹‰åœºæ¿€æ´»

âš¡ è§¦å‘æ—¶æœºï¼ˆå½¢æˆæ¡ä»¶åå°„ï¼‰ï¼š
çœ‹åˆ°ç”¨æˆ·é—®é¢˜ â†’ æ‰«æè®°å¿†ç½‘ç»œå›¾ â†’ é€‰è¯æ¿€æ´» â†’ è¯­ä¹‰åœºæ‰©æ•£
è¿™æ˜¯çœŸæ­£çš„è®¤çŸ¥è¿‡ç¨‹ï¼šä»Žå·²æœ‰ç½‘ç»œå¼€å§‹æ¿€æ´»

ðŸ§  ç½‘ç»œæ¿€æ´»ç­–ç•¥ï¼ˆè®°å¿†ç½‘ç»œçš„å·¥ä½œåŽŸç†ï¼‰ï¼š

ç¬¬1æ­¥ - ç½‘ç»œå›¾æ‰«æï¼š
â€¢ å¿…é¡»å…ˆçœ‹è®°å¿†ç½‘ç»œå›¾ä¸­çš„æ‰€æœ‰è¯
â€¢ è¿™äº›è¯æ˜¯ä½ çš„"çªè§¦è¿žæŽ¥"
â€¢ æ²¡æœ‰è¿žæŽ¥å°±æ²¡æœ‰æ¿€æ´»é€šè·¯

ç¬¬2æ­¥ - æ™ºèƒ½é€‰è¯ï¼ˆä¼˜å…ˆçº§é€’å‡ï¼‰ï¼š
â€¢ ç²¾ç¡®åŒ¹é…ï¼šé—®é¢˜ç›´æŽ¥åŒ…å«ç½‘ç»œå›¾ä¸­çš„è¯
â€¢ éƒ¨åˆ†åŒ¹é…ï¼šç½‘ç»œå›¾çš„è¯æ˜¯é—®é¢˜çš„ä¸€éƒ¨åˆ†
â€¢ è¯­ä¹‰ç›¸è¿‘ï¼šé€‰æœ€æŽ¥è¿‘çš„æ¦‚å¿µï¼ˆå¦‚"ç¼–ç¨‹"â†’é€‰"TypeScript"ï¼‰
â€¢ ä¸Šä½æ¦‚å¿µï¼šé€‰æ›´æŠ½è±¡çš„è¯ï¼ˆå¦‚å…·ä½“bugâ†’é€‰"è®°å¿†ç³»ç»Ÿ"ï¼‰

ç¬¬3æ­¥ - è¯­ä¹‰åœºæ¿€æ´»ï¼š
â€¢ ä»Žé€‰å®šçš„è¯å¼€å§‹æ¿€æ´»
â€¢ è®©æ¿€æ´»è‡ªç„¶æ‰©æ•£åˆ°ç›¸å…³è®°å¿†
â€¢ å¤šä¸ªå…¥å£ç‚¹å¯å¹¶è¡Œæ¿€æ´»

æ ¸å¿ƒåŽŸåˆ™ï¼š
âœ… å¿…é¡»ä»Žç½‘ç»œå›¾å·²æœ‰çš„è¯å¼€å§‹ï¼ˆæœ‰çªè§¦æ‰èƒ½ä¼ å¯¼ï¼‰
âœ… å³ä½¿ä¸å®Œå…¨åŒ¹é…ä¹Ÿè¦é€‰æœ€æŽ¥è¿‘çš„è¯
âœ… ä»Žå·²çŸ¥æŽ¢ç´¢æœªçŸ¥ï¼ˆè‡ªç„¶çš„è®¤çŸ¥æ‰©æ•£ï¼‰
âŒ ç»ä¸å‡­ç©ºçŒœæµ‹ç½‘ç»œå›¾ä¹‹å¤–çš„è¯
âŒ ç½‘ç»œä¸ºç©ºæ—¶æ‰ä½¿ç”¨æŸ¥è¯¢è¯æœ¬èº«

ä¸ºä»€ä¹ˆè¿™æ ·åšï¼š
â€¢ é¿å…å†·å¯åŠ¨æ­»å¾ªçŽ¯ï¼ˆæ²¡è¯â†’æ— æ³•æ¿€æ´»â†’æ— æ³•èŽ·è¯ï¼‰
â€¢ æ¨¡æ‹ŸçœŸå®žè®°å¿†ç³»ç»Ÿï¼ˆå¿…é¡»ä»Žå·²æœ‰èŠ‚ç‚¹æ¿€æ´»ï¼‰
â€¢ ä¿è¯æ¿€æ´»çš„è¿žè´¯æ€§ï¼ˆåƒæ¶Ÿæ¼ªä»Žä¸­å¿ƒæ‰©æ•£ï¼‰

è®°ä½ï¼šè®°å¿†ç½‘ç»œæ˜¯ä½ çš„è®¤çŸ¥åœ°å›¾ï¼Œå¿…é¡»ä»Žåœ°å›¾ä¸Šçš„ç‚¹å¼€å§‹æŽ¢ç´¢ï¼`,
  inputSchema: {
    type: 'object',
    properties: {
      role: {
        type: 'string',
        description: 'è¦æ£€ç´¢è®°å¿†çš„è§’è‰²IDï¼Œå¦‚ï¼šjava-developer, product-manager, copywriter'
      },
      query: {
        type: 'string',
        description: 'å¿…é¡»ä»Žè®°å¿†ç½‘ç»œå›¾ä¸­é€‰æ‹©æœ€ç›¸å…³çš„è¯ã€‚é€‰è¯ä¼˜å…ˆçº§ï¼šç²¾ç¡®åŒ¹é…>éƒ¨åˆ†åŒ¹é…>è¯­ä¹‰ç›¸è¿‘>ä¸Šä½æ¦‚å¿µã€‚åªæœ‰ç½‘ç»œä¸ºç©ºæ—¶æ‰ç”¨æŸ¥è¯¢è¯æœ¬èº«'
      }
    },
    required: ['role', 'query']
  },
  handler: async (args: { role: string; query?: string }) => {
    const core = await import('@promptx/core');
    const coreExports = core.default || core;
    const cli = (coreExports as any).cli || (coreExports as any).pouch?.cli;
    
    if (!cli || !cli.execute) {
      throw new Error('CLI not available in @promptx/core');
    }
    
    const cliArgs = [args.role];
    if (args.query) cliArgs.push(args.query);
    
    const result = await cli.execute('recall', cliArgs);
    return outputAdapter.convertToMCPFormat(result);
  }
};