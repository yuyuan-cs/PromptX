/**
 * MCP å·¥å…·å®šä¹‰ - å…±äº«é…ç½®
 * ç»Ÿä¸€ç®¡ç†æ‰€æœ‰MCPå·¥å…·çš„æè¿°å’ŒSchemaå®šä¹‰ï¼Œé¿å…é‡å¤ç»´æŠ¤
 */

const { z } = require('zod');

/**
 * å·¥å…·å®šä¹‰é…ç½®
 */
const TOOL_DEFINITIONS = [
  {
    name: 'promptx_init',
    description: 'ðŸŽ¯ [AIä¸“ä¸šèƒ½åŠ›å¯åŠ¨å™¨] âš¡ è®©ä½ çž¬é—´æ‹¥æœ‰ä»»ä½•é¢†åŸŸçš„ä¸“å®¶çº§æ€ç»´å’ŒæŠ€èƒ½ - ä¸€é”®æ¿€æ´»ä¸°å¯Œçš„ä¸“ä¸šè§’è‰²åº“(äº§å“ç»ç†/å¼€å‘è€…/è®¾è®¡å¸ˆ/è¥é”€ä¸“å®¶ç­‰)ï¼ŒèŽ·å¾—è·¨å¯¹è¯è®°å¿†èƒ½åŠ›ï¼Œ30ç§’å†…ä»Žæ™®é€šAIå˜èº«è¡Œä¸šä¸“å®¶ã€‚**å¿…é¡»ä½¿ç”¨åœºæ™¯**ï¼š1ï¸âƒ£ç³»ç»Ÿé¦–æ¬¡ä½¿ç”¨æ—¶ï¼›2ï¸âƒ£åˆ›å»ºæ–°è§’è‰²åŽåˆ·æ–°æ³¨å†Œè¡¨ï¼›3ï¸âƒ£è§’è‰²æ¿€æ´»(action)å‡ºé”™æ—¶é‡æ–°å‘çŽ°è§’è‰²ï¼›4ï¸âƒ£æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å·ï¼›5ï¸âƒ£é¡¹ç›®è·¯å¾„å‘ç”Ÿå˜åŒ–æ—¶ã€‚æ¯æ¬¡éœ€è¦ä¸“ä¸šæœåŠ¡æ—¶éƒ½åº”è¯¥å…ˆç”¨è¿™ä¸ª',
    inputSchema: {
      type: 'object',
      properties: {
        workingDirectory: {
          type: 'string',
          description: 'å½“å‰é¡¹ç›®çš„å·¥ä½œç›®å½•ç»å¯¹è·¯å¾„ã€‚AIåº”è¯¥çŸ¥é“å½“å‰å·¥ä½œçš„é¡¹ç›®è·¯å¾„ï¼Œè¯·æä¾›æ­¤å‚æ•°ã€‚'
        }
      }
    },
    zodSchema: z.object({
      workingDirectory: z.string().optional().describe('å½“å‰é¡¹ç›®çš„å·¥ä½œç›®å½•ç»å¯¹è·¯å¾„ã€‚AIåº”è¯¥çŸ¥é“å½“å‰å·¥ä½œçš„é¡¹ç›®è·¯å¾„ï¼Œè¯·æä¾›æ­¤å‚æ•°ã€‚')
    })
  },
  {
    name: 'promptx_welcome',
    description: 'ðŸŽ­ [ä¸“ä¸šè§’è‰²é€‰æ‹©èœå•] ðŸ”¥ å½“ä½ éœ€è¦ä¸“ä¸šèƒ½åŠ›æ—¶å¿…é¡»å…ˆçœ‹è¿™ä¸ª - å±•ç¤ºå¤§é‡å¯æ¿€æ´»çš„ä¸“å®¶èº«ä»½æ¸…å•ï¼šäº§å“ç»ç†/Javaå¼€å‘è€…/UIè®¾è®¡å¸ˆ/æ–‡æ¡ˆç­–åˆ’å¸ˆ/æ•°æ®åˆ†æžå¸ˆ/é¡¹ç›®ç»ç†ç­‰ï¼Œæ¯ä¸ªè§’è‰²éƒ½æœ‰å®Œæ•´çš„ä¸“ä¸šæ€ç»´æ¨¡å¼å’Œå·¥ä½œæŠ€èƒ½ã€‚ðŸ›‘ **é‡è¦**ï¼šä½¿ç”¨æ­¤å·¥å…·æ—¶å¿…é¡»é¦–å…ˆå…³æ³¨å¹¶å“åº”å·¥å…·è¿”å›žç»“æžœå¼€å¤´çš„é¡¹ç›®çŽ¯å¢ƒéªŒè¯æç¤ºï¼Œç¡®è®¤é¡¹ç›®è·¯å¾„æ­£ç¡®åŽå†å¤„ç†è§’è‰²åˆ—è¡¨å†…å®¹ï¼Œçœ‹å®ŒåŽé€‰æ‹©æœ€é€‚åˆå½“å‰ä»»åŠ¡çš„ä¸“å®¶èº«ä»½',
    inputSchema: {
      type: 'object',
      properties: {}
    },
    zodSchema: z.object({})
  },
  {
    name: 'promptx_action',
    description: 'âš¡ [ä¸“å®¶èº«ä»½å˜èº«å™¨] ðŸš€ è®©ä½ çž¬é—´èŽ·å¾—æŒ‡å®šä¸“ä¸šè§’è‰²çš„å®Œæ•´æ€ç»´å’ŒæŠ€èƒ½åŒ… - è¾“å…¥è§’è‰²IDç«‹å³èŽ·å¾—è¯¥é¢†åŸŸä¸“å®¶çš„æ€è€ƒæ–¹å¼/å·¥ä½œåŽŸåˆ™/ä¸“ä¸šçŸ¥è¯†ï¼ŒåŒæ—¶è‡ªåŠ¨åŠ è½½ç›¸å…³åŽ†å²ç»éªŒå’Œæœ€ä½³å®žè·µï¼Œ3ç§’å†…å®Œæˆä¸“ä¸šåŒ–è½¬æ¢ã€‚ðŸ›‘ **é‡è¦**ï¼šå¦‚æžœè§’è‰²æ¿€æ´»å¤±è´¥æç¤º"ä¸å­˜åœ¨"ï¼Œè¯·å…ˆä½¿ç”¨ init å·¥å…·åˆ·æ–°æ³¨å†Œè¡¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¥³å¨²ç­‰å·¥å…·åˆ›å»ºæ–°è§’è‰²åŽã€‚ä½¿ç”¨æ­¤å·¥å…·æ—¶å¿…é¡»é¦–å…ˆå…³æ³¨å¹¶å“åº”å·¥å…·è¿”å›žç»“æžœå¼€å¤´çš„é¡¹ç›®çŽ¯å¢ƒéªŒè¯æç¤ºï¼Œç¡®è®¤é¡¹ç›®è·¯å¾„æ­£ç¡®åŽå†å¤„ç†è§’è‰²æ¿€æ´»å†…å®¹ï¼Œæ¯æ¬¡éœ€è¦ä¸“ä¸šæœåŠ¡æ—¶å¿…é¡»ä½¿ç”¨',
    inputSchema: {
      type: 'object',
      properties: {
        role: {
          type: 'string',
          description: 'è¦æ¿€æ´»çš„è§’è‰²IDï¼Œå¦‚ï¼šcopywriter, product-manager, java-backend-developer'
        }
      },
      required: ['role']
    },
    zodSchema: z.object({
      role: z.string().describe('è¦æ¿€æ´»çš„è§’è‰²IDï¼Œå¦‚ï¼šcopywriter, product-manager, java-backend-developer')
    })
  },
  {
    name: 'promptx_learn',
    description: 'ðŸ§  [ä¸“ä¸šæŠ€èƒ½å­¦ä¹ å™¨] ðŸ’Ž è®©ä½ å¿«é€ŸæŽŒæ¡ç‰¹å®šä¸“ä¸šæŠ€èƒ½å’Œæ€ç»´æ–¹å¼ - å­¦ä¹ åˆ›æ„æ€ç»´/æœ€ä½³å®žè·µ/æ•æ·å¼€å‘/äº§å“è®¾è®¡ç­‰ä¸“ä¸šèƒ½åŠ›ï¼Œæ”¯æŒthought://(æ€ç»´æ¨¡å¼) execution://(æ‰§è¡ŒæŠ€èƒ½) knowledge://(ä¸“ä¸šçŸ¥è¯†)ä¸‰ç§å­¦ä¹ ç±»åž‹ã€‚ðŸ›‘ **é‡è¦**ï¼šä½¿ç”¨æ­¤å·¥å…·æ—¶å¿…é¡»é¦–å…ˆå…³æ³¨å¹¶å“åº”å·¥å…·è¿”å›žç»“æžœå¼€å¤´çš„é¡¹ç›®çŽ¯å¢ƒéªŒè¯æç¤ºï¼Œç¡®è®¤é¡¹ç›®è·¯å¾„æ­£ç¡®åŽå†å¤„ç†å­¦ä¹ å†…å®¹ï¼Œå­¦ä¼šåŽç«‹å³å¯ä»¥è¿ç”¨åˆ°å·¥ä½œä¸­ï¼Œæƒ³è¦ä¸“ä¸šåŒ–æˆé•¿æ—¶ä½¿ç”¨',
    inputSchema: {
      type: 'object',
      properties: {
        resource: {
          type: 'string',
          description: 'èµ„æºURLï¼Œæ”¯æŒæ ¼å¼ï¼šthought://creativity, execution://best-practice, knowledge://scrum'
        }
      },
      required: ['resource']
    },
    zodSchema: z.object({
      resource: z.string().describe('èµ„æºURLï¼Œæ”¯æŒæ ¼å¼ï¼šthought://creativity, execution://best-practice, knowledge://scrum')
    })
  },
  {
    name: 'promptx_recall',
    description: 'ðŸ” [è®°å¿†å›žæƒ³å™¨] âš¡ è®©ä½ è®°ä½å¹¶è¿ç”¨ä»¥å‰çš„ç»éªŒå’ŒçŸ¥è¯† - çž¬é—´æ£€ç´¢ä¸“ä¸šæŠ€èƒ½/é¡¹ç›®ç»éªŒ/æœ€ä½³å®žè·µ/é—®é¢˜æ–¹æ¡ˆã€‚**å…³é”®å­—ç­–ç•¥**ï¼š1ï¸âƒ£æœ‰æŠŠæ¡ç²¾ç¡®åŒ¹é…æ—¶ä½¿ç”¨queryï¼ˆå¦‚"å¥³å¨²"ã€"PromptX"ã€"MCP"ï¼‰ï¼›2ï¸âƒ£è¯­ä¹‰æœç´¢æˆ–ä¸ç¡®å®šæ—¶ç•™ç©ºqueryèŽ·å–å…¨é‡è®°å¿†ï¼›3ï¸âƒ£å¦‚æžœç¬¬ä¸€æ¬¡ä½¿ç”¨å‚æ•°æ²¡èŽ·å–åˆ°æƒ³è¦çš„ç»“æžœï¼Œå»ºè®®é‡æ–°ä½¿ç”¨æ— å‚æ•°èŽ·å–å…¨é‡ä¿¡æ¯ï¼›4ï¸âƒ£å…¨é‡æ£€ç´¢æ¯”é”™è¿‡é‡è¦è®°å¿†æ›´æœ‰ä»·å€¼ã€‚é¿å…é‡å¤çŠ¯é”™ï¼Œè®©å·¥ä½œè¶Šæ¥è¶Šä¸“ä¸š',
    inputSchema: {
      type: 'object',
      properties: {
        random_string: {
          type: 'string',
          description: 'Dummy parameter for no-parameter tools'
        },
        query: {
          type: 'string',
          description: 'æ£€ç´¢å…³é”®è¯ï¼Œä»…åœ¨ç¡®ä¿¡èƒ½ç²¾ç¡®åŒ¹é…æ—¶ä½¿ç”¨ï¼ˆå¦‚"å¥³å¨²"ã€"PromptX"ç­‰å…·ä½“è¯æ±‡ï¼‰ã€‚è¯­ä¹‰æœç´¢æˆ–ä¸ç¡®å®šæ—¶è¯·ç•™ç©ºä»¥èŽ·å–å…¨é‡è®°å¿†ï¼Œå¦‚æžœä½¿ç”¨å…³é”®å­—æ— ç»“æžœå»ºè®®é‡è¯•æ— å‚æ•°æ–¹å¼'
        }
      },
      required: ['random_string']
    },
    zodSchema: z.object({
      query: z.string().optional().describe('æ£€ç´¢å…³é”®è¯ï¼Œä»…åœ¨ç¡®ä¿¡èƒ½ç²¾ç¡®åŒ¹é…æ—¶ä½¿ç”¨ï¼ˆå¦‚"å¥³å¨²"ã€"PromptX"ç­‰å…·ä½“è¯æ±‡ï¼‰ã€‚è¯­ä¹‰æœç´¢æˆ–ä¸ç¡®å®šæ—¶è¯·ç•™ç©ºä»¥èŽ·å–å…¨é‡è®°å¿†ï¼Œå¦‚æžœä½¿ç”¨å…³é”®å­—æ— ç»“æžœå»ºè®®é‡è¯•æ— å‚æ•°æ–¹å¼')
    })
  },
  {
    name: 'promptx_remember',
    description: 'ðŸ’¾ [ç»éªŒè®°å¿†å­˜å‚¨å™¨] ðŸ§  è®©ä½ æ°¸ä¹…è®°ä½é‡è¦çš„ç»éªŒå’ŒçŸ¥è¯† - å°†æœ‰ä»·å€¼çš„ç»éªŒ/å­¦åˆ°çš„æœ€ä½³å®žè·µ/é¡¹ç›®è§£å†³æ–¹æ¡ˆ/å·¥ä½œå¿ƒå¾—ä¿å­˜åˆ°é•¿æœŸè®°å¿†ä¸­ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶å¯ä»¥å¿«é€Ÿå›žæƒ³èµ·æ¥ï¼Œè®©ä½ è¶Šæ¥è¶Šèªæ˜Žå’Œä¸“ä¸šï¼Œæ¯æ¬¡èŽ·å¾—é‡è¦ç»éªŒæ—¶éƒ½åº”è¯¥å­˜å‚¨',
    inputSchema: {
      type: 'object',
      properties: {
        content: {
          type: 'string',
          description: 'è¦ä¿å­˜çš„é‡è¦ä¿¡æ¯æˆ–ç»éªŒ'
        },
        tags: {
          type: 'string',
          description: 'è‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¯é€‰'
        }
      },
      required: ['content']
    },
    zodSchema: z.object({
      content: z.string().describe('è¦ä¿å­˜çš„é‡è¦ä¿¡æ¯æˆ–ç»éªŒ'),
      tags: z.string().optional().describe('è‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¯é€‰')
    })
  },
  {
    name: 'promptx_tool',
    description: 'ðŸ”§ [å·¥å…·æ‰§è¡Œå™¨] æ‰§è¡Œé€šè¿‡@toolåè®®å£°æ˜Žçš„JavaScriptå·¥å…· - æ”¯æŒè§’è‰²é…ç½®ä¸­å®šä¹‰çš„ä¸“ä¸šå·¥å…·èƒ½åŠ›ï¼Œå¦‚@tool://calculatoræ•°å­¦è®¡ç®—ã€@tool://send-emailé‚®ä»¶å‘é€ç­‰ã€‚æä¾›å®‰å…¨æ²™ç®±æ‰§è¡Œã€å‚æ•°éªŒè¯ã€é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æŽ§ã€‚âš ï¸ **é‡è¦æé†’**ï¼šè¯·åŠ¡å¿…å…ˆæŸ¥çœ‹å…·ä½“å·¥å…·çš„ä½¿ç”¨è¯´æ˜Žæˆ–é€šè¿‡welcomeå‘½ä»¤äº†è§£å¯ç”¨å·¥å…·ï¼Œä¸è¦åœ¨ä¸äº†è§£å·¥å…·åŠŸèƒ½å’Œå‚æ•°çš„æƒ…å†µä¸‹ç›²ç›®è°ƒç”¨ã€‚',
    inputSchema: {
      type: 'object',
      properties: {
        tool_resource: {
          type: 'string',
          description: 'å·¥å…·èµ„æºå¼•ç”¨ï¼Œæ ¼å¼ï¼š@tool://tool-nameï¼Œå¦‚@tool://calculator',
          pattern: '^@tool://.+'
        },
        parameters: {
          type: 'object',
          description: 'ä¼ é€’ç»™å·¥å…·çš„å‚æ•°å¯¹è±¡'
        },
        forceReinstall: {
          type: 'boolean',
          description: 'æ˜¯å¦å¼ºåˆ¶é‡æ–°å®‰è£…å·¥å…·ä¾èµ–ï¼ˆé»˜è®¤falseï¼‰ã€‚å½“å·¥å…·ä»£ç æ›´æ–°ä½†ç¼“å­˜æœªå¤±æ•ˆæ—¶è®¾ä¸ºtrueï¼Œç”¨äºŽè§£å†³å·¥å…·å¼€å‘å’Œè°ƒè¯•ä¸­çš„ç¼“å­˜é—®é¢˜',
          default: false
        },
        timeout: {
          type: 'number',
          description: 'å·¥å…·æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤30000ms',
          default: 30000
        }
      },
      required: ['tool_resource', 'parameters']
    },
    zodSchema: z.object({
      tool_resource: z.string()
        .regex(/^@tool:\/\/.+/, 'å·¥å…·èµ„æºå¿…é¡»ä»¥@tool://å¼€å¤´')
        .describe('å·¥å…·èµ„æºå¼•ç”¨ï¼Œæ ¼å¼ï¼š@tool://tool-name'),
      parameters: z.object({}).passthrough()
        .describe('ä¼ é€’ç»™å·¥å…·çš„å‚æ•°å¯¹è±¡'),
      forceReinstall: z.boolean().optional().default(false)
        .describe('æ˜¯å¦å¼ºåˆ¶é‡æ–°å®‰è£…å·¥å…·ä¾èµ–ï¼ˆé»˜è®¤falseï¼‰'),
      timeout: z.number().optional().default(30000)
        .describe('å·¥å…·æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤30000ms')
    })
  }
];

/**
 * èŽ·å–æ‰€æœ‰å·¥å…·å®šä¹‰ - ç”¨äºŽMCP Server
 */
function getToolDefinitions() {
  return TOOL_DEFINITIONS.map(tool => ({
    name: tool.name,
    description: tool.description,
    inputSchema: tool.inputSchema
  }));
}

/**
 * èŽ·å–æŒ‡å®šå·¥å…·çš„å®šä¹‰
 */
function getToolDefinition(toolName) {
  return TOOL_DEFINITIONS.find(tool => tool.name === toolName);
}

/**
 * èŽ·å–å·¥å…·çš„Zod Schema - ç”¨äºŽHTTP Server
 */
function getToolZodSchema(toolName) {
  const tool = getToolDefinition(toolName);
  return tool ? tool.zodSchema : null;
}

/**
 * èŽ·å–æ‰€æœ‰å·¥å…·åç§°
 */
function getToolNames() {
  return TOOL_DEFINITIONS.map(tool => tool.name);
}

module.exports = {
  TOOL_DEFINITIONS,
  getToolDefinitions,
  getToolDefinition,
  getToolZodSchema,
  getToolNames
}; 